# 布局优化

## 绘制原理
* CPU负责计算显示内容
* GPU负责栅格化（UI元素绘制到屏幕上）
* 16ms发出VSync信号触发UI渲染
* 大多数的Android设备屏幕刷新率60Hz
*
## 优化工具
* 关注Frames
* 正常：绿色圆点；丢帧：黄色或红色
* Alert栏
## Layout Inspector
* AndroidStudio自带工具
* 查看视图层次结构

## Choreographer
* 获取FPS，线上使用，具备实时性：API16之后，Choreographer.getInstance().postFrameCallback

## 布局加载流程
setContentView --> LayoutInflater --> inflate --> getLayout（IO耗时） --> createViewFromTag --> Factory --> create --> 反射

### 性能瓶颈
布局文件解析：IO过程
创建View对象：反射

### LayoutInflater.Factory
* LayoutInflater创建VIew的一个Hook
* 订制创建View的过程：全局替换自定义TextView等

### Factory与Factory2
* Factory2继承与Factory
* 多了一个参数：parent

### 常规方式
* 背景： 获取每个界面加载耗时
* 实现：覆写方法，手动埋点

### AOP实现
* 切activity的setContentView

### 获取每一个控件的耗时
* 低侵入性
* LayoutInflater.Factory
