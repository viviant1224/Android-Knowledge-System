# 启动优化

## 冷启动
Click Event --> IPC --> Process.start --> ActivityThread --> bindApplication --> lifeCycle --> ViewRootImpl

## 热启动
后台 --> 前台

## 温启动
LifeCycle

## 冷启动相关任务

### 冷启动之前（系统行为无法干预）： 
* 启动app
* 加载空白window
* 创建进程
* 
### 随后任务
* 创建application
* 启动主线程
* 创建mainactivity
### 在随后任务：

* 加载布局
* 布置屏幕
* 首帧绘制

### 冷启动优化方向：
Application 和Activity生命周期

## 启动时间测量方式
### adb命令
adb命令：adb shell am start -W packagename/首屏activity  
adb shell am start -W com.adamrocker.android.input.simeji/jp.baidu.simeji.home.HomeActivity  

ThisTime：最后一个activity启动耗时  
totaltime：所有activity启动耗时  
waittime：AMS启动activity的总耗时  

### 手动打点：
onWindowFocusChanged只是首帧时间  
尽量采用feed第一条数据展示（贴近用户真实体验）  

## 工具选择

### traceview\systrace
使用方式：  
Debug.startMethodTracing("");  
Debug.stopMethodTracing("");  
生成文件在sd卡：Android/data/packagename/files

### Systrace
walltime:代码执行的时间  
cputime是代码消耗cpu的时间（重点指标）  
二者数据不一致：例子（锁冲突）  

获取方法耗时：  
System.currentTimeMilis()  
SystemClock.currentThreadTimeMilis() // CPU执行时间

## AOP非侵入式打点
Aspect Oriented Programmin：针对同一类问题的统一处理、无侵入添加代码
![image](https://raw.githubusercontent.com/viviant1224/Android-Knowledge-System/main/images/AOP.webp)  

### AspectJ

![image](https://raw.githubusercontent.com/viviant1224/Android-Knowledge-System/main/images/AspectJ.webp)  
* Join Points
* PointCut
* Advice:一种Hook要插入代码的位置







